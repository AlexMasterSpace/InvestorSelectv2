<!DOCTYPE html>
<html lang="es" prefix="og: http://ogp.me/ns#" class="no-js">
<head>
    <meta charset="UTF-8">

    <link rel='stylesheet' id='qis_style-css' href='https://sxuncoestrategico.com/wp-content/plugins/quick-interest-slider/slider.css?ver=5.9.10' type='text/css' media='all'/>
    <script type='text/javascript' src='https://sxuncoestrategico.com/wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2/dist/chartjs-plugin-annotation.min.js"></script>

    <style type="text/css" media="screen">
        body {
            font-family: sans-serif;
            font-weight: 100;
            overflow:hidden;
        }

        .qis-slidercenter {
            color: #465069;
            font-size: 1em;
        }

        .qis-sliderleft, .qis-sliderright {
            color: #2F2E2E;
            font-size: 1em;
        }

        .qis-total {
            color: #465069;
            font-size: 1.5em;
            margin: 0 0 1em 0;
        }

        input[type=range] {
            width: 100%;
            height: 8px;
            border-radius: 20px;
            background: #d3d3d3;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #d3d3d3;
            border-radius: 20px;
        }
        
        input[type=range]::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #43BBDD;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            margin-top: -6px;
        }
        
        input[type=range]:active::-webkit-slider-thumb,
        input[type=range]:focus::-webkit-slider-thumb {
            background: #43BBDD;
        }
        
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #d3d3d3;
            border-radius: 20px;
        }
        
        input[type=range]::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #43BBDD;
            cursor: pointer;
        }
        
        input[type=range]:active::-moz-range-thumb,
        input[type=range]:focus::-moz-range-thumb {
            background: #43BBDD;
        }
        
        input[type=range]::-ms-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
        }
        
        input[type=range]::-ms-fill-upper {
            background: #d3d3d3;
            border-radius: 20px;
        }
        
        input[type=range]::-ms-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #43BBDD;
            cursor: pointer;
            margin-top: 0;
        }
        
        input[type=range]:active::-ms-thumb,
        input[type=range]:focus::-ms-thumb {
            background: #43BBDD;
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            background: linear-gradient(to right, rgb(117, 117, 117) 0%, rgb(117, 117, 117) var(--percent), #d3d3d3 var(--percent), #d3d3d3 100%);
        }
        
        input[type=range] {
            --percent: calc((var(--value) - var(--min)) / (var(--max) - var(--min)) * 100%);
        }

        .qis_slider_markers {
            position: relative;
            margin-left: 1em;
            margin-right: 1em;
            border-left: 1px solid black;
            border-right: 1px solid black;
            height: 10px;
        }

        .qis_slider_marker {
            position: absolute;
            height: 10px;
            width: 1px;
            background-color: black;
        }

        .chart-container  {
            width: 50%; /* Ajusta el ancho del div del gráfico según sea necesario */
            height: 1000px; /* Ajusta la altura del div del gráfico según sea necesario */
            margin: 0 auto; /* Centra el div horizontalmente */
        }

        #myChart {
            width: 100%; /* El canvas se ajusta al 100% del contenedor */
            height: 100%; /* El canvas se ajusta al 100% del contenedor */
        }
    </style>
</head>
<body 
data-rsssl=1 class="home page-template-default page page-id-2291 wpb-js-composer js-comp-ver-5.4.7 vc_responsive">
    <section class="parent-section no-padding post-2291 page type-page status-publish hentry">
        <div class="container-fluid">
            <div class="row">
                <div class="entry-content">
                    <section>
                        <div class="container">
                            <div class="row">
                                <div data-front-class="col-xs-mobile-fullwidth col-sm-8 front-column-class" class="wpb_column hcode-column-container col-xs-mobile-fullwidth col-sm-8">
                                    <div class="vc-column-innner-wrapper">
                                        <form action="" class="" id="qis_1">
                                            <div class="qis-sections qis-float">
                                                <div class="qis-inputs qis-float-columns">
                                                    <input type="hidden" name="interesttype" value="compound"/>
                                                    
                                                    <div class="range qis-slider-principal">
                                                        <div class="qis-slideroutput qis-loan">
                                                            <span class="qis-sliderleft qis-min">$500,000</span>
                                                            <span class="qis-sliderbuttonleft">&nbsp;</span>
                                                            <span class="qis-slidercenter">
                                                                <output id="principalValue"></output>
                                                            </span>
                                                            <span class="qis-sliderbuttonright">&nbsp;</span>
                                                            <span class="qis-sliderright qis-max">$5,000,000</span>
                                                        </div>
                                                        <input type="range" id="principal" name="checkradio input" min="500000" max="5000000" value="500000" step="100000" data-qis>
                                                        <div class="qis_slider_markers" id="principalMarkers"></div>
                                                    </div>
                                                    
                                                    <div class="range">
                                                        <div class="qis-slideroutput qis-loan">
                                                            <span class="qis-sliderleft qis-min">1 año</span>
                                                            <span class="qis-sliderbuttonleft">&nbsp;</span>
                                                            <span class="qis-slidercenter">
                                                                <output id="yearsValue"></output>
                                                            </span>
                                                            <span class="qis-sliderbuttonright">&nbsp;</span>
                                                            <span class="qis-sliderright qis-max">5 años</span>
                                                        </div>
                                                        <input type="range" id="years" name="loan-period" min="1" max="5" value="1" step="1" data-qis>
                                                        <div class="qis_slider_markers" id="yearsMarkers"></div>
                                                    </div>
                                                    <div class="qis-total">
                                                        <h1 style="text-align: center;">
                                                            <span style="color: #2F2E2E;">USTED RECIBE:</span>
                                                            <span style="color: #43BBDD;">
                                                                <span class="final_total" id="result"></span>
                                                                MXN*
                                                            </span>
                                                        </h1>
                                                    </div>
                                                    
                                                    <!-- Inicio del div para el gráfico -->
                                                    <div class="chart-container">
                                                        <canvas id="myChart"></canvas>
                                                    </div>
                                                    <!-- Fin del div para el gráfico -->
                                                    
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </section>

    <script type="text/javascript">
        const principalSlider = document.getElementById('principal');
        const yearsSlider = document.getElementById('years');
        const principalValue = document.getElementById('principalValue');
        const yearsValue = document.getElementById('yearsValue');
        const result = document.getElementById('result');
        const ctx = document.getElementById('myChart').getContext('2d');

        const numberFormatter = new Intl.NumberFormat('en-US', {
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        });

        let myChart;

        function updateChart(principal, maxYears) {
    if (myChart) {
        myChart.destroy();
    }

    const labels = [];
    const data = [];
    const additionalData = [];
    const additionalData2 = [];
    const rate = 0.275;

    let maxYValue = 0; // Inicializa el valor máximo del eje Y
    let annotations = []; // Array para almacenar las anotaciones
    let gridLines = []; // Array para almacenar las posiciones de las líneas del grid

    for (let year = 1; year <= maxYears; year++) {
        labels.push(`${year} año${year > 1 ? 's' : ''}`);
        const calculatedValue = principal * Math.pow(1 + rate, year);
        data.push(calculatedValue);
        additionalData.push(principal);
        additionalData2.push(principal);

        // Añade anotaciones incrementales para los años
        annotations.push({
            type: 'line',
            yMin: principal * year,
            yMax: principal * year,
            borderColor: 'rgba(0, 0, 0, 0.2)', // Color visible de la línea
            borderDash: [7, 7], // Línea discontinua

            borderWidth: 2, // Grosor de la línea de anotación
            z: -1, // Asegura que la línea esté por encima del grid
            label: {
                content: ` $${(principal * year).toLocaleString('en-US')}`,
                enabled: true,
                position: 'start',
                backgroundColor: 'white',
                borderWidth: 1,
                color: 'black', // Color del texto
                font: {
                    size: 9.1// Tamaño de la fuente
                },
                xAdjust: -28,
                yAdjust: -11
            }
        });

        // Añade la posición al array de gridLines
        gridLines.push(principal * year);

        // Actualiza el valor máximo del eje Y si es necesario
        if (calculatedValue > maxYValue) {
            maxYValue = calculatedValue;
        }
    }

    // También considera el valor del principal en el máximo del eje Y
    maxYValue = Math.max(maxYValue, principal * maxYears); // Asegúrate de que el máximo del eje Y es suficiente para las anotaciones

    // Nuevo grosor reducido en un 30%
    const originalBarThickness = 20;
    const reducedBarThickness = originalBarThickness * 0.70;

    myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Debajo del colchón',
                    data: additionalData,
                    backgroundColor: '#333399',
                    borderColor: '#000000', // Color del borde
                    borderWidth: 1, // Grosor del borde
                    barThickness: reducedBarThickness, // Grosor reducido de las barras
                    categoryPercentage: 0.4,
                    barPercentage: 0.1
                },
                {
                    label: 'Inflación anual',
                    data: additionalData2,
                    backgroundColor: '#ff9933',
                    borderColor: '#000000', // Color del borde
                    borderWidth: 1, // Grosor del borde
                    barThickness: reducedBarThickness, // Grosor reducido de las barras
                    categoryPercentage: 0.4,
                    barPercentage: 0.2
                },
                {
                    label: 'Valor de la inversión mensual',
                    data: data,
                    backgroundColor: '#43BBDD',
                    borderColor: '#000000', // Color del borde
                    borderWidth: 1, // Grosor del borde
                    barThickness: reducedBarThickness, // Grosor reducido de las barras
                    categoryPercentage: 0.4,
                    barPercentage: 0.5
                }
            ]
        },
        options: {
            scales: {
                x: {
                    stacked: false
                },
                y: {
                    beginAtZero: true,
                    min: 0, // Ajusta el valor mínimo del eje Y
                    max: Math.ceil(maxYValue / 1000) * 1000, // Ajusta el valor máximo del eje Y a un múltiplo de 1000
                    ticks: {
                        display: false, // Oculta los números en el eje Y
                    },
                    grid: {
                        display: true, // Muestra las líneas de la cuadrícula del eje Y
                        color: function(context) {
                            // Muestra las líneas del grid solo en las posiciones donde hay anotaciones
                             return gridLines.includes(context.tick.value) ? 'rgba(0, 0, 0, 0)' : 'rgba(0, 0, 0, 0)';
                        },
                        borderColor: 'white', // Color del borde del eje Y
                        borderWidth: 1, // Ancho del borde del eje Y
                        borderDash: [7, 7], // Línea discontinua
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: $${context.raw.toLocaleString('en-US')}`;
                        }
                    }
                },
                annotation: {
                    annotations: [
                        ...annotations,
                        {
                            type: 'line',
                            xMin: -0.2, // Coloca la línea vertical justo antes del primer grupo de barras
                            xMax: -0.2,  // Coloca la línea vertical justo después del primer grupo de barras
                            borderColor: 'rgba(0, 0, 0, 1)', // Color de la línea vertical
                            borderWidth: 2, // Grosor de la línea vertical
                         
                            z: 1, // Asegura que la línea esté por encima de las barras
                            label: {
                                content: '',
                                enabled: true,
                                position: 'start',
                                backgroundColor: 'white',
                                borderWidth: 1,
                                color: 'black', // Color del texto
                                font: {
                                    size: 10 // Tamaño de la fuente
                                },
                                xAdjust: 10,
                                yAdjust: 0
                            }
                        }
                    ]
                }
            }
        }
    });
}




        function updateCalculation() {
            const principal = parseFloat(principalSlider.value);
            const years = parseInt(yearsSlider.value);
            const rate = 0.275;

            principalValue.textContent = `$${numberFormatter.format(principal)}`;
            principalValue.style.color = '#43BBDD';

            yearsValue.textContent = `${years} ${years === 1 ? 'año' : 'años'}`;
            yearsValue.style.color = '#43BBDD';

            const finalAmount = principal * Math.pow(1 + rate, years);
            result.textContent = `$${numberFormatter.format(finalAmount)}`;

            updateChart(principal, years);
        }

        function addMarkers() {
            const principalRangeInput = document.getElementById('principal');
            const yearsRangeInput = document.getElementById('years');
            const principalMarkersContainer = document.getElementById('principalMarkers');
            const yearsMarkersContainer = document.getElementById('yearsMarkers');
            
            const addMarkersForSlider = (slider, markersContainer) => {
                const min = parseInt(slider.min, 10);
                const max = parseInt(slider.max, 10);
                const step = parseInt(slider.step, 10);

                markersContainer.innerHTML = '';

                for (let value = min; value <= max; value += step) {
                    const marker = document.createElement('div');
                    marker.className = 'qis_slider_marker';
                    marker.style.position = 'absolute';
                    marker.style.height = '10px';
                    marker.style.width = '1px';
                    marker.style.backgroundColor = 'black';
                    marker.style.left = `${((value - min) / (max - min) * 100)}%`;
                    marker.style.marginLeft = '-1px';

                    markersContainer.appendChild(marker);
                }
            }

            addMarkersForSlider(principalRangeInput, principalMarkersContainer);
            addMarkersForSlider(yearsRangeInput, yearsMarkersContainer);
        }

        // Inicializa el gráfico y la calculadora
        updateCalculation();
        addMarkers();
        
        // Agrega evento a los sliders para actualizar en tiempo real
        principalSlider.addEventListener('input', () => {
            updateCalculation();
            addMarkers();
        });
        yearsSlider.addEventListener('input', () => {
            updateCalculation();
            addMarkers();
        });
    </script>
</body>
</html>